<!DOCTYPE html>

<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- OBS Browser Source iÃ§in autoplay permissions -->
    <meta http-equiv="Feature-Policy" content="autoplay 'self'" />
    <meta name="referrer" content="no-referrer" />

    <title>Deprem Bildirimleri - OBS Overlay</title>

    <style>
      * {
        margin: 0;

        padding: 0;

        box-sizing: border-box;
      }

      body {
        background: transparent;

        font-family: "Arial", sans-serif;

        overflow: hidden;
      }

      .deprem-container {
        position: fixed;
        top: 30px;
        right: 30px;
        min-width: 380px;
        max-width: 450px;
        transform: translateX(110%);
        transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
      }

      .deprem-container.show {
        transform: translateX(0);
      }

      .deprem-bildirim {
        background: linear-gradient(135deg, #ff4757, #ff3742);
        color: white;
        padding: 24px;
        border-radius: 16px;
        box-shadow: 0 20px 40px rgba(255, 71, 87, 0.3), 0 8px 16px rgba(0, 0, 0, 0.1);
        border: none;
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
      }

      .deprem-bildirim::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, #ff6b7a, #ff4757, #ff3742);
        border-radius: 16px 16px 0 0;
      }

      .deprem-baslik {
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        letter-spacing: 0.5px;
        text-transform: uppercase;
        opacity: 0.9;
      }

      .deprem-baslik::before {
        content: "âš ";
        margin-right: 8px;
        font-size: 18px;
        background: rgba(255, 255, 255, 0.2);
        width: 32px;
        height: 32px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .deprem-bilgi {
        margin-bottom: 8px;

        font-size: 14px;
      }

      .buyukluk {
        font-size: 36px;
        font-weight: 700;
        text-align: center;
        background: rgba(255, 255, 255, 0.15);
        padding: 16px 20px;
        border-radius: 12px;
        margin: 16px 0;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
        letter-spacing: 1px;
      }

      .konum {
        font-size: 20px;
        font-weight: 600;
        text-align: center;
        margin-bottom: 12px;
        line-height: 1.2;
      }

      .detaylar {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 12px;
        font-size: 13px;
        margin-top: 16px;
      }

      .detay-item {
        background: rgba(255, 255, 255, 0.08);
        padding: 12px 14px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
        transition: background 0.2s ease;
      }

      .detay-item strong {
        display: block;
        font-weight: 600;
        margin-bottom: 4px;
        opacity: 0.8;
        font-size: 11px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .status {
        position: fixed;
        bottom: 20px;
        left: 20px;
        color: #27ae60;
        font-size: 11px;
        background: rgba(0, 0, 0, 0.8);
        padding: 8px 14px;
        border-radius: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        font-weight: 500;
        letter-spacing: 0.3px;
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0) scale(1);
        }
        10%,
        30%,
        50%,
        70%,
        90% {
          transform: translateX(-3px) scale(1.02);
        }
        20%,
        40%,
        60%,
        80% {
          transform: translateX(3px) scale(1.02);
        }
      }

      @keyframes slideIn {
        0% {
          transform: translateX(110%) scale(0.9);
          opacity: 0;
        }
        100% {
          transform: translateX(0) scale(1);
          opacity: 1;
        }
      }

      .shake {
        animation: shake 0.5s ease-in-out;
      }

      .deprem-container.show {
        animation: slideIn 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
      }
    </style>
  </head>

  <body>
    <div class="deprem-container" id="depremContainer">
      <div class="deprem-bildirim">
        <div class="deprem-baslik">DEPREM UYARISI</div>

        <div class="konum" id="konum">-</div>

        <div class="buyukluk" id="buyukluk">-</div>

        <div class="detaylar">
          <div class="detay-item">
            <strong>Zaman:</strong><br />

            <span id="zaman">-</span>
          </div>

          <div class="detay-item">
            <strong>Derinlik:</strong><br />

            <span id="derinlik">-</span>
          </div>
        </div>
      </div>
    </div>

    <div class="status" id="status">BaÄŸlantÄ± kuruluyor...</div>

    <script src="/socket.io/socket.io.js"></script>

    <script>
      const socket = io();

      const container = document.getElementById("depremContainer");

      const status = document.getElementById("status");

      // Ses dosyasÄ± ayarlarÄ±
      const bildirimSesi = new Audio("/alarm.mp3");
      bildirimSesi.preload = "auto";
      bildirimSesi.volume = 0.5;

      // Debug iÃ§in console log
      console.log("OBS Overlay baÅŸlatÄ±ldÄ±:", new Date().toISOString());

      // Ses dosyasÄ± yÃ¼kleme durumunu kontrol et
      bildirimSesi.addEventListener("canplaythrough", () => {
        console.log("âœ… Ses dosyasÄ± yÃ¼klendi ve Ã§almaya hazÄ±r");
      });

      bildirimSesi.addEventListener("error", (e) => {
        console.error("âŒ Ses dosyasÄ± yÃ¼klenemedi:", e);
        console.log("Kontrol edin: /alarm.mp3 dosyasÄ± public klasÃ¶rÃ¼nde var mÄ±?");
      });

      // BaÄŸlantÄ± durumu
      socket.on("connect", () => {
        console.log("Socket.IO baÄŸlandÄ±, ID:", socket.id);
        status.textContent = "ðŸŸ¢ BaÄŸlÄ± - Depremler dinleniyor (ID: " + socket.id + ")";
        status.style.color = "#2ecc71";
      });

      socket.on("disconnect", () => {
        console.log("Socket.IO baÄŸlantÄ±sÄ± koptu");
        status.textContent = "ðŸ”´ BaÄŸlantÄ± koptu";
        status.style.color = "#e74c3c";
      });

      // Yeni deprem bildirimi
      socket.on("yeni_deprem", (data) => {
        console.log("Deprem bildirimi alÄ±ndÄ±:", data);
        console.log("Timestamp:", new Date().toISOString());
        showDepremBildirimi(data);

        // Ses Ã§almayÄ± dene
        console.log("Ses Ã§almaya Ã§alÄ±ÅŸÄ±lÄ±yor...");

        bildirimSesi.currentTime = 0;
        bildirimSesi
          .play()
          .then(() => {
            console.log("âœ… Ses baÅŸarÄ±yla Ã§alÄ±ndÄ±!");
          })
          .catch((error) => {
            console.error("âŒ Ses Ã§alÄ±namadÄ±:", error.message);
            console.log("ðŸ’¡ OBS'te Browser Source ayarlarÄ±nÄ± kontrol edin:");
            console.log("   - 'Control audio via OBS' kapalÄ± olmalÄ±");
            console.log("   - 'Restart when source becomes active' aÃ§Ä±k olmalÄ±");
          });
      });

      function showDepremBildirimi(deprem) {
        console.log("showDepremBildirimi Ã§aÄŸrÄ±ldÄ±:", deprem);

        // Bilgileri gÃ¼ncelle
        if (!deprem || typeof deprem !== "object") {
          console.error("Invalid earthquake data received:", deprem);
          return;
        }

        const { il, ilce, buyukluk, zaman, derinlik } = deprem;

        if (!il || !ilce || !buyukluk || buyukluk === undefined || !zaman || !derinlik || derinlik === undefined) {
          console.error("Eksik deprem verisi:", deprem);

          return;
        }

        document.getElementById("konum").textContent = `${deprem.il} - ${deprem.ilce}`;

        document.getElementById("buyukluk").textContent = `${deprem.buyukluk} ML`;

        const tarih = new Date(zaman);

        if (isNaN(tarih.getTime())) {
          console.error("Invalid date format:", zaman);

          document.getElementById("zaman").textContent = "-";
        } else {
          document.getElementById("zaman").textContent = tarih.toLocaleString("tr-TR");
        }

        document.getElementById("derinlik").textContent = `${derinlik} km`;

        // BÃ¼yÃ¼klÃ¼ÄŸe gÃ¶re renk ayarla

        const buyuklukFloat = parseFloat(buyukluk);

        const bildirim = container.querySelector(".deprem-bildirim");

        if (isNaN(buyuklukFloat)) {
          console.error("Invalid magnitude:", buyukluk);

          return;
        }

        if (buyuklukFloat >= 5.0) {
          bildirim.style.background = "linear-gradient(135deg, #9b59b6, #8e44ad)";
          bildirim.style.boxShadow = "0 20px 40px rgba(155, 89, 182, 0.4), 0 8px 16px rgba(0, 0, 0, 0.1)";
        } else if (buyuklukFloat >= 4.0) {
          bildirim.style.background = "linear-gradient(135deg, #f39c12, #e67e22)";
          bildirim.style.boxShadow = "0 20px 40px rgba(243, 156, 18, 0.4), 0 8px 16px rgba(0, 0, 0, 0.1)";
        } else {
          bildirim.style.background = "linear-gradient(135deg, #ff4757, #ff3742)";
          bildirim.style.boxShadow = "0 20px 40px rgba(255, 71, 87, 0.3), 0 8px 16px rgba(0, 0, 0, 0.1)";
        }

        // Bildirimi gÃ¶ster

        container.classList.add("show");

        container.classList.add("shake");

        // TitreÅŸimi kaldÄ±r

        setTimeout(() => {
          container.classList.remove("shake");
        }, 600);

        // 10 saniye sonra gizle

        setTimeout(() => {
          container.classList.remove("show");
        }, 10000);
      }

      // Test iÃ§in (geliÅŸtirme aÅŸamasÄ±nda)

      //   setTimeout(() => {

      //     showDepremBildirimi({

      //       il: "Denizli",

      //       ilce: "Pamukkale",

      //       buyukluk: 4.2,

      //       zaman: new Date().toISOString(),

      //       derinlik: 8.8,

      //     });

      //   }, 2000);
    </script>
  </body>
</html>
